{% extends 'base.html.twig' %}
{% block afternav %}
{% if app.user.level > 2 %}{% if max_devices > current_devices or max_devices == 0 %}
	<a href="/devices/new" CLASS="BTN BTN-SUCCESS" style="margin-top: 5px;">New Device</a>
{% endif %}{%endif %}
{% endblock %}
{% block body %}
<div class="span10">
	{% for device in devices %}
	<div class="row span10" style="border-bottom: 1px solid #ccc">
		<div class="span3">
		<strong>Name</strong>: {% if device.active == 1%}<a href="{{app.system.protocol}}://{{app.system.path}}/devices/view/{{device.id}}">{{device.name}}</a>{% else %}{{device.name}}{%endif %}<br />
		<strong>IP</strong>:{{device.ip}}<br />
		<strong>Status</strong>:{{device.status}}<br />
		
		</div>
		<div class="span1">
			<img src="assets/img/{% if device.online == 1 %}online{% else %}offline{% endif %}.png" alt="{% if device.online == 1 %}online{% else %}offline{% endif %}" title="{% if device.online == 1 %}Online{% else %}Offline{% endif %}"/>
		</div>
		{% if app.user.level > 2 %}
		<div class="span2" style="padding-top: 5px;"><input type="checkbox" id="{{device.id}}" {% if device.active%}checked="checked"{%endif%}/>
		</div>
		{% endif %}
	</div>
	{% else %}
	<div class="row span10">
	<p>You haven't added any devices yet!</p>
	</div>
	{% endfor %}
</div>
{#
<div class="span12">
	<pre>
	{{dump()}}

	</pre>
</div>
#}
{% endblock %}
{% block stylesheets %}
{{parent()}}
<link href="/assets/css/jquery.ibutton.css" rel="stylesheet">
{% endblock %}
{% block javascripts %}
{{parent()}}
<script src="/assets/js/easing.js"></script>
<script src="/assets/js/jquery.ibutton.js"></script>
<script type="text/javascript">
$(document).ready(function() {
{% for device in devices %}
	
	$('#{{device.id}}').iButton({
	labelOn: "Active",
	labelOff: "Inactive",
		change: function($input) {
			var checkbox = $input.is(":checked") ? true : false;
			var id = $input.attr("id");
			if (checkbox == true) var message = "Enable this Device?";
			else var message = "Disable this device and delete associated data?\n (THERE IS NO UNDO)";
			if (window.confirm(message)){
			$.post(
				'{{app.system.protocol}}://{{app.system.path}}/api/devices?action=enable',
				{id: id, active: checkbox},
				function(data) {
					console.log(data);
				}
			);
		} else {
			$('#{{device.id}}').attr('checked', !$('#{{device.id}}').attr('checked')).iButton("repaint");
		}
		}
	});
	{% endfor %}
});
</script>
{% endblock %}