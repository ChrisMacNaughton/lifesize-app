{% extends 'base.html.twig' %}
{% block body %}
<h1 style="display: inline-block;">{{device.name}}</h1><a href="{{app.system.protocol}}://{{app.system.path}}/devices/edit/{{device.id}}">Edit</a><br />
<div class="row">
	<div class="span3">
	<h3>Screenshot</h3>
	<img src="{{app.system.protocol}}://{{app.system.path}}/devices/img/{{device.id}}" width="208px" height="117px" />
	</div>
	<div class="span3">
		<h3>Device Data</h3>
		<strong>Online:</strong> {% if device.online == 1%}Yes{%else %}No{%endif %}<br />
		<strong>Call Length:</strong> {{device.duration}} Hours
	</div>
</div>
<div class="row">
<div id="statsTable" class="span11"></div>
</div>
<div style="row span12">
	<h3>Worst Calls (Not included in stats above)</h3>
<table style="text-align: center;" class="span12">
	<tr>
		<th style="border-right:1px solid #ccc;">Start Time</th>
		<th style="border-right:1px solid #ccc;">Duration</th>
		<th style="border-right:1px solid #ccc;">Packet Loss Ratio</th>
	</tr>{% set i = 0 %}
	{% for call in worst_calls %}
	<tr>
		<td style="border-right:1px solid #ccc;">{{call.StartTime}}</td>
		<td style="border-right:1px solid #ccc;">{{call.Duration}}</td>
		<td style="border-right:1px solid #ccc;">{{call.Ratio}}</td>
	</tr>{% set i = i + 1 %}
	<!-- {{dump(stat)}} -->
	{% endfor %}
</table>
</div>
{#
<pre>
{{dump(worst_calls)}}
</pre>
#}
{% endblock %}
{% block javascripts %}
{{parent()}}
<script type="text/javascript">
var chart;
	$(document).ready(function() {
		chart = new Highcharts.Chart({
		chart: {
			renderTo: 'statsTable',
			type: 'line',
			marginRight: 130,
			marginBottom: 25
		},
		title: {
			text: 'Average Call Stats',
			x: -20 //center
		},
		credits: {
			enabled: false
		},
		xAxis: {
			categories: [0000,0100,0200,0300,0400,0500,0600,0700,0800,0900,1000,1100,1200,1300,1400,1500,1600,1700,1800,1900,2000,2100,2200,2300]
			},
		yAxis: [{
			title: {
				text: 'Packets Lost'
			},
			plotLines: [{
				value: 0,
				width: 1,
				color: '#808080'
			}],
			min: 0
		}, {
			title: {
				text: 'Jitter',
				style: {
					color: '#4572A7'
				}
			},
			labels: {
				formatter: function() {
					return this.value +' ms';
				}
			},
			opposite: true,
			min: 0
		}, {
			title: {
				text: 'Call Length'
			},
			opposite: true,
			min: 0
		}],
		tooltip: {
			shared: true
		},
		legend: {
			verticalAlign: 'top',
			y: 40,
			floating: true
		},
		series: [
		{
			name: 'PktsLost',
			yAxis: 0,
			data: [{% for row in stats %}{% if row.0 + row.1 == ''%}0{%else%}{{row.0 + row.1}}{%endif%},{% endfor %}]
		},{
			name: 'Jitter (ms)',
			yAxis: 1,
			data: [{% for row in stats %}{% if row.2 + row.3 == ''%}0{%else%}{{row.2 + row.3}}{%endif%},{% endfor %}],
		},{
			name: 'Call Length (min)',
			yAxis: 2,
			data: [{% for row in stats %}{% if row.4 == ''%}0{%else%}Math.round({{row.4 /60 }},2){%endif%},{% endfor %}],
		}
		]
		/*
Old data:
		{
			name: 'Tokyo',
			data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
		}, {
			name: 'New York',
			data: [-0.2, 0.8, 5.7, 11.3, 17.0, 22.0, 24.8, 24.1, 20.1, 14.1, 8.6, 2.5]
		}, {
			name: 'Berlin',
			data: [-0.9, 0.6, 3.5, 8.4, 13.5, 17.0, 18.6, 17.9, 14.3, 9.0, 3.9, 1.0]
		}, {
			name: 'London',
			data: [3.9, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0, 16.6, 14.2, 10.3, 6.6, 4.8]
		}
		*/
	});

	});
</script>
{% endblock %}